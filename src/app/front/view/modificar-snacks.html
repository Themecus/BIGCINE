<div class="modificar-page">
  <section class="hero">
    <div class="hero-inner">
      <div>
        <h1 class="hero-title">
          <span class="cartelera-icon">‚úèÔ∏è</span>
          <span class="cartelera-nombre">MODIFICAR</span>
          <span class="cartelera-destacado">SNACKS</span>
        </h1>
        <p class="hero-subtitle">Selecciona un snack para modificar sus datos</p>
      </div>
    </div>
  </section>

  <div class="container mt-4">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card bg-warning text-dark">
          <div class="card-body text-center">
            <h5 class="card-title">Snacks disponibles: {{ snacks.length }}</h5>
            <p class="card-text mb-2">Selecciona un snack de la lista para modificar sus datos</p>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="snacks.length === 0" class="text-center py-5">
      <div class="alert alert-info">
        <h4>üçø ¬°No hay snacks para modificar!</h4>
        <p class="mb-0">Ve a "Agregar Snacks" para a√±adir productos a tu dulcer√≠a.</p>
      </div>
    </div>

    <div *ngIf="snacks.length > 0">
      <!-- Vista de selecci√≥n -->
      <div class="row mb-5" *ngIf="!snackEditando">
        <div class="col-12">
          <h3 class="text-center mb-4">Selecciona un snack para modificar</h3>
          <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            <div class="col" *ngFor="let snack of snacks">
              <div class="card h-100 shadow-sm snack-card modificar-card" 
                   (click)="iniciarEdicion(snack)">
                <div class="card-img-container">
                  <div class="snack-icon-container">
                    <span class="snack-icon-large">
                      {{ getIconoCategoria(snack.categoria) }}
                    </span>
                  </div>
                  <div class="modificar-overlay">
                    <span class="modificar-text">‚úèÔ∏è MODIFICAR</span>
                  </div>
                </div>
                <div class="card-body">
                  <h5 class="snack-nombre">{{ snack.nombre }}</h5>
                  <p class="snack-meta mb-1">
                    <strong>Categor√≠a:</strong> {{ getNombreCategoria(snack.categoria) }}
                  </p>
                  <p class="snack-meta mb-1">
                    <strong>Precio:</strong> {{ formatearPrecio(snack.precio) }}
                  </p>
                  <p class="snack-meta mb-0">
                    <strong>Stock:</strong> 
                    <span [class.text-danger]="snack.stock < 10" [class.text-success]="snack.stock >= 10">
                      {{ snack.stock }} unidades
                    </span>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Vista de edici√≥n -->
      <div *ngIf="snackEditando" class="row">
        <div class="col-12">
          <div class="card shadow-lg">
            <div class="card-header bg-primary text-white">
              <h5 class="card-title mb-0">
                ‚úèÔ∏è Modificando: <strong>{{ snackEditando.nombre }}</strong>
              </h5>
            </div>
            <div class="card-body">
              <div class="row mb-4">
                <div class="col-md-6">
                  <h6>Vista previa actual:</h6>
                  <div class="card">
                    <div class="card-body text-center">
                      <span class="snack-icon-preview">
                        {{ getIconoCategoria(snackEditando.categoria) }}
                      </span>
                      <h6 class="card-title mt-2">{{ snackEditando.nombre }}</h6>
                      <p class="card-text small mb-1">
                        <strong>Categor√≠a:</strong> {{ getNombreCategoria(snackEditando.categoria) }}
                      </p>
                      <p class="card-text small mb-1">
                        <strong>Precio:</strong> {{ formatearPrecio(snackEditando.precio) }}
                      </p>
                      <p class="card-text small mb-0">
                        <strong>Stock:</strong> {{ snackEditando.stock }} unidades
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <h6>Vista previa nueva:</h6>
                  <div class="card">
                    <div class="card-body text-center">
                      <span class="snack-icon-preview">
                        {{ getIconoCategoria(snackTemporal.categoria || snackEditando.categoria) }}
                      </span>
                      <h6 class="card-title mt-2">{{ snackTemporal.nombre || snackEditando.nombre }}</h6>
                      <p class="card-text small mb-1">
                        <strong>Categor√≠a:</strong> {{ getNombreCategoria(snackTemporal.categoria) || getNombreCategoria(snackEditando.categoria) }}
                      </p>
                      <p class="card-text small mb-1">
                        <strong>Precio:</strong> {{ formatearPrecio(snackTemporal.precio) || formatearPrecio(snackEditando.precio) }}
                      </p>
                      <p class="card-text small mb-0">
                        <strong>Stock:</strong> {{ snackTemporal.stock || snackEditando.stock }} unidades
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <label for="nombreEditado" class="form-label fw-bold">Nombre del Snack</label>
                  <input
                    id="nombreEditado"
                    type="text"
                    class="form-control"
                    placeholder="Ej: Palomitas Grandes, Combo Familiar..."
                    [(ngModel)]="snackTemporal.nombre"
                  >
                </div>
                <div class="col-12 col-md-6">
                  <label for="categoriaEditada" class="form-label fw-bold">Categor√≠a</label>
                  <select
                    id="categoriaEditada"
                    class="form-select"
                    [(ngModel)]="snackTemporal.categoria"
                  >
                    <option *ngFor="let cat of categorias" [value]="cat.value">
                      {{ cat.label }}
                    </option>
                  </select>
                </div>
                <div class="col-12 col-md-6">
                  <label for="precioEditado" class="form-label fw-bold">Precio ($)</label>
                  <input
                    id="precioEditado"
                    type="number"
                    class="form-control"
                    placeholder="0.00"
                    min="0"
                    step="0.01"
                    [(ngModel)]="snackTemporal.precio"
                  >
                </div>
                <div class="col-12 col-md-6">
                  <label for="stockEditado" class="form-label fw-bold">Stock</label>
                  <input
                    id="stockEditado"
                    type="number"
                    class="form-control"
                    placeholder="0"
                    min="0"
                    [(ngModel)]="snackTemporal.stock"
                  >
                </div>
                <div class="col-12">
                  <label for="descripcionEditada" class="form-label fw-bold">Descripci√≥n</label>
                  <textarea
                    id="descripcionEditada"
                    class="form-control"
                    rows="3"
                    placeholder="Descripci√≥n del producto..."
                    [(ngModel)]="snackTemporal.descripcion"
                  ></textarea>
                </div>
              </div>
              
              <small class="text-muted mt-2 d-block">
                üí° Modifica los datos que necesites y guarda los cambios
              </small>

              <div class="d-flex gap-2 mt-4">
                <button class="btn btn-secondary" (click)="cancelarEdicion()">
                  ‚Ü©Ô∏è Cancelar
                </button>
                <button 
                  class="btn btn-warning flex-grow-1"
                  (click)="guardarCambios()"
                  [disabled]="!snackTemporal.nombre?.trim() || snackTemporal.precio <= 0">
                  üíæ Guardar Cambios
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de confirmaci√≥n -->
  <div *ngIf="mostrarConfirmacion" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">‚ö†Ô∏è Confirmar Modificaci√≥n</h3>
      </div>
      <div class="modal-body">
        <p>¬øEst√°s seguro de que quieres modificar el snack?</p>
        <p class="h6 text-center text-warning fw-bold">
          "{{ snackEditando?.nombre }}"
        </p>
        <p class="small text-muted text-center">
          Los cambios se aplicar√°n inmediatamente al inventario
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cancelarModificacion()">Cancelar</button>
        <button class="btn btn-warning" (click)="confirmarGuardado()">
          üíæ S√≠, Modificar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de √©xito -->
  <div *ngIf="mostrarExito" class="modal-overlay">
    <div class="modal-content success-modal">
      <div class="modal-header">
        <h3 class="modal-title">‚úÖ Modificaci√≥n Exitosa</h3>
      </div>
      <div class="modal-body">
        <p class="text-center mb-0">El snack se ha modificado correctamente</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" (click)="cerrarExito()">Aceptar</button>
      </div>
    </div>
  </div>
</div>